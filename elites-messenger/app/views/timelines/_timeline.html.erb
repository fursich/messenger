
<%
  is_reply = false if is_reply == nil?
%>

<div class = "per<%= ' mine' if mypost?(t) %><%= ' reply' if is_reply %>">
  <p class='icon'>
    <% if t.user.thumbnail? %>
      <%= image_tag t.user.thumbnail.url %>
    <% else %>
      NO IMAGE
    <% end %>
  </p>
  <%= simple_format t.message, class: 'message' %>
  <% if mypost?(t) %>
    <div class='operation'>
      <%= link_to root_path(id: t.id, message: t.message) do %>
        <%= button_tag 'Edit', class: 'btn btn-info' %>
      <% end %>
      <%= button_to 'Del', timeline_path(t), method: :delete, class: 'btn btn-danger', data: {confirm: '削除してよろしいですか？'} %>
    </div>
  <% else %>
    <%= link_to root_path(reply_id: t.id) do %>
      <%= button_tag 'Re', class: 'btn btn-info' %>
    <% end %>


    <div class="clickale-like-link clickable-like-link-<%= t.id %>">
      <% Reaction.emotions.each do |emo, emo_id| %>
        <% next if emo_id==0 %>      
        <% if t.has_emotion?(current_user.id, emo_id) %>
          <% cl = class_by_emotion(emo) + " emotion-icon-selected" %>
        <% else %>
          <% cl = class_by_emotion(emo) + " emotion-icon-not-selected" %>
        <% end %>
        <%= link_to "", create_like_on_timeline_path(id: t.id, emo_id: emo,format: :json), remote: true, method: :post, class: cl %>
      <% end %>
    </div>

    <div class="likes-counter likes-counter-<%= t.id %>">
      <% if t.reactions.count>0 %>
        <%= render 'likes/like', t_id: t.id  %>
      <% end %>
    </div>

  <% end %>
</div>

<% t.replies.each do |r| %>
  <%= render 'timelines/timeline', t: r, is_reply: true %>
<% end %>


